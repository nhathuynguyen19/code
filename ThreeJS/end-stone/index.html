<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perlin Noise Terrain with Color Gradient</title>
    <style>
        #terrainCanvas {
            image-rendering: pixelated; /* Để các pixel không bị làm mờ */
            width: 320px; /* Kích thước hiển thị */
            height: 320px; /* Kích thước hiển thị */
        }
    </style>
</head>
<body>
    <canvas id="terrainCanvas" width="16" height="16"></canvas>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <script>
        // Hàm chuyển đổi màu từ định dạng hex sang định dạng RGB
        function hexToRgb(hex) {
            const bigint = parseInt(hex.slice(1), 16); // Chuyển đổi hex thành số nguyên
            const r = (bigint >> 16) & 255; // Lấy giá trị red
            const g = (bigint >> 8) & 255;  // Lấy giá trị green
            const b = bigint & 255;         // Lấy giá trị blue
            return [r, g, b]; // Trả về một mảng chứa các giá trị red, green, và blue
        }

        // Hàm nội suy màu sắc giữa hai màu dựa trên giá trị factor
        function interpolateColor(color1, color2, factor) {
            const result = color1.slice(); // Sao chép mảng color1
            for (let i = 0; i < 3; i++) {
                result[i] = Math.round(result[i] + factor * (color2[i] - color1[i])); // Tính toán giá trị màu
            }
            return result; // Trả về màu đã nội suy
        }

        // Hàm tạo địa hình sử dụng Simplex noise và nội suy màu sắc
        function generateTerrain(width, height) {
            const canvas = document.getElementById('terrainCanvas'); // Lấy phần tử canvas từ DOM
            const ctx = canvas.getContext('2d'); // Lấy đối tượng context để vẽ
            const imageData = ctx.createImageData(width, height); // Tạo đối tượng ImageData mới
            const data = imageData.data; // Lấy mảng dữ liệu pixel

            const simplex = new SimplexNoise(); // Tạo đối tượng SimplexNoise mới
            const color1 = hexToRgb('#C1BA88'); // Chuyển đổi màu đầu tiên từ hex sang RGB
            const color2 = hexToRgb('#EFF4B7'); // Chuyển đổi màu thứ hai từ hex sang RGB

            for (let x = 0; x < width; x++) {
                for (let y = 0; y < height; y++) {
                    const value = simplex.noise2D(x / 4, y / 4); // Tạo giá trị nhiễu Simplex
                    const factor = (value + 1) / 2; // Chuyển đổi giá trị từ -1 đến 1 thành 0 đến 1
                    const color = interpolateColor(color1, color2, factor); // Nội suy màu sắc
                    const cell = (x + y * width) * 4; // Tính toán chỉ số pixel trong mảng dữ liệu
                    data[cell] = color[0];        // Đặt giá trị red
                    data[cell + 1] = color[1];    // Đặt giá trị green
                    data[cell + 2] = color[2];    // Đặt giá trị blue
                    data[cell + 3] = 255;         // Đặt giá trị alpha
                }
            }

            ctx.putImageData(imageData, 0, 0); // Vẽ ImageData lên canvas
        }

        // Gọi hàm generateTerrain với độ phân giải 16x16
        generateTerrain(16, 16);
    </script>
</body>
</html>
